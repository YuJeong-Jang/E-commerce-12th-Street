// 플러그인 설정
plugins {
    id 'java'
    id 'application'
}

// 프로젝트 그룹 및 버전
group = 'com.commerce'
version = '1.0-SNAPSHOT'

// 자바 버전 설정
java {
    sourceCompatibility = '17'
    targetCompatibility = '17'
}

// 메인 클래스 지정 (Embedded Tomcat 실행)
application {
    mainClass = 'com.commerce.member.Main'
}

// 의존성 다운로드 저장소
repositories {
    mavenCentral()
}

// 프로젝트 의존성
dependencies {
    implementation 'org.mariadb.jdbc:mariadb-java-client:3.4.1'

    implementation 'org.apache.tomcat.embed:tomcat-embed-core:10.1.20'
    implementation 'org.apache.tomcat.embed:tomcat-embed-jasper:10.1.20'
    implementation 'org.apache.tomcat.embed:tomcat-embed-el:10.1.20'

    compileOnly 'jakarta.servlet:jakarta.servlet-api:6.0.0'
    compileOnly 'jakarta.servlet.jsp:jakarta.servlet.jsp-api:3.1.0'

    implementation 'jakarta.servlet.jsp.jstl:jakarta.servlet.jsp.jstl-api:3.0.0'
    implementation 'org.glassfish.web:jakarta.servlet.jsp.jstl:3.0.1'
}

// JAR 파일 설정
jar {
    manifest {
        attributes(
            'Main-Class': 'com.commerce.member.Main',
            'Implementation-Title': project.name,
            'Implementation-Version': project.version
        )
    }
}

// Fat JAR 생성 태스크 (모든 의존성 포함)
tasks.register('fatJar', Jar) {
    archiveClassifier = 'all'
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    
    manifest {
        attributes 'Main-Class': 'com.commerce.member.Main'
    }
    
    from {
        configurations.runtimeClasspath.collect { 
            it.isDirectory() ? it : zipTree(it) 
        }
    }
    
    with jar
}

// 인코딩 설정
tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
